pip install streamlit
import streamlit as st
import random

st.set_page_config(page_title="ç†ä¸å°½â—‹Ã—ã‚²ãƒ¼ãƒ ", layout="centered")

# åˆæœŸçŠ¶æ…‹ã®è¨­å®š
if 'board' not in st.session_state:
    st.session_state.board = [''] * 9
    st.session_state.turn = 1
    st.session_state.game_over = False
    st.session_state.message = ''
    st.session_state.cpu_moves = []

# å‹åˆ©ãƒ‘ã‚¿ãƒ¼ãƒ³
WIN_PATTERNS = [
    [0, 1, 2], [3, 4, 5], [6, 7, 8],  # æ¨ª
    [0, 3, 6], [1, 4, 7], [2, 5, 8],  # ç¸¦
    [0, 4, 8], [2, 4, 6]              # æ–œã‚
]

def check_win(player):
    b = st.session_state.board
    return any(all(b[i] == player for i in pattern) for pattern in WIN_PATTERNS)

def cpu_turn():
    board = st.session_state.board
    cpu_moves = st.session_state.cpu_moves

    if st.session_state.turn == 1:
        # CPUã¯ä¸­å¤®ã«ç½®ã
        board[4] = 'â—‹'
        cpu_moves.append(4)

    elif st.session_state.turn == 3:
        # ãƒ©ãƒ³ãƒ€ãƒ ã«ç©ºã„ã¦ã‚‹å ´æ‰€ã«ç½®ã
        empty = [i for i in range(9) if board[i] == '']
        move = random.choice(empty)
        board[move] = 'â—‹'
        cpu_moves.append(move)

    elif st.session_state.turn == 5:
        # 3å›ç›®ã§ç›´ç·šã‚’å®Œæˆã•ã›ã‚‹
        for pattern in WIN_PATTERNS:
            filled = [i for i in pattern if i in cpu_moves]
            empty = [i for i in pattern if board[i] == '']
            if len(filled) == 2 and len(empty) == 1:
                board[empty[0]] = 'â—‹'
                cpu_moves.append(empty[0])
                break

    if check_win('â—‹'):
        st.session_state.game_over = True
        st.session_state.message = 'CPUã®å‹ã¡ã§ã™ï¼ï¼ˆç†ä¸å°½ï¼‰'

    st.session_state.turn += 1

def player_turn(pos):
    board = st.session_state.board

    if board[pos] == '' and not st.session_state.game_over:
        board[pos] = 'Ã—'
        st.session_state.turn += 1

        if check_win('Ã—'):
            st.session_state.game_over = True
            st.session_state.message = 'ã‚ãªãŸã®å‹ã¡ã§ã™ï¼'
        else:
            cpu_turn()

def reset_game():
    st.session_state.board = [''] * 9
    st.session_state.turn = 1
    st.session_state.game_over = False
    st.session_state.message = ''
    st.session_state.cpu_moves = []
    cpu_turn()

st.title('ç†ä¸å°½â—‹Ã—ã‚²ãƒ¼ãƒ ')
st.caption('CPUã¯çµ¶å¯¾ã«å‹ã¡ã¾ã™ ğŸ˜ˆ')

# ã‚²ãƒ¼ãƒ é–‹å§‹æ™‚ã«CPUãŒåˆæ‰‹ã‚’æ‰“ã¤
if st.session_state.turn == 1 and not st.session_state.cpu_moves:
    cpu_turn()

# ã‚²ãƒ¼ãƒ ãƒœãƒ¼ãƒ‰
cols = st.columns(3)
for i in range(3):
    for j in range(3):
        index = i * 3 + j
        with cols[j]:
            if st.session_state.board[index] == '':
                if not st.session_state.game_over:
                    if st.button(" ", key=str(index), help=f"{i+1}è¡Œ{j+1}åˆ—"):
                        player_turn(index)
                else:
                    st.button(st.session_state.board[index] or " ", key=str(index), disabled=True)
            else:
                st.button(st.session_state.board[index], key=str(index), disabled=True)

# ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
if st.session_state.message:
    st.markdown(f"### {st.session_state.message}")

# ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³
if st.button('ã‚‚ã†ä¸€åº¦éŠã¶'):
    reset_game()
